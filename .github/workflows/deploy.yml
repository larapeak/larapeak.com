name: Deploy

on:
  workflow_dispatch
    
jobs:
          
  deploy:
   
    runs-on: ubuntu-latest
    
    steps:
      - name: ‚¨áÔ∏è Website down
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          password: ${{ secrets.SSH_PASSWORD }}
          script: |
            cd github/larapeak.com
            php artisan down
    
      - name: üåÄ Clone repository
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          password: ${{ secrets.SSH_PASSWORD }}
          script: |
            cd github/larapeak.com
            git pull
            
      - name: üéª Run composer
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          password: ${{ secrets.SSH_PASSWORD }}
          script: |
            cd github/larapeak.com
            composer install --optimize-autoloader --no-dev
            
      - name: üåÖ Generate assets
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          password: ${{ secrets.SSH_PASSWORD }}
          script: |
            cd github/larapeak.com
            npm install
            npm run prod
            php artisan clear-compiled
            
      - name: üôà Migrate database
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          password: ${{ secrets.SSH_PASSWORD }}
          script: |
            cd github/larapeak.com
            php artisan migrate --force
            
      - name: üôè Bless release
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          password: ${{ secrets.SSH_PASSWORD }}
          script: |
            cd github/larapeak.com
            php artisan config:cache
            php artisan route:cache
            php artisan view:cache
            
      - name: ‚¨ÜÔ∏è Website up
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          password: ${{ secrets.SSH_PASSWORD }}
          script: |
            cd github/larapeak.com
            php artisan up
